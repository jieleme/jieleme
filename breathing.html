<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±å‘¼å¸å¹²é¢„ - è‡ªå¾‹è®¡æ—¶å™¨</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .breathing-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .breathing-header {
            margin-bottom: 20px;
        }

        .breathing-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .breathing-subtitle {
            font-size: 16px;
            color: #666;
        }

        .online-tag {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .online-tag .dot {
            color: #4CAF50;
            margin-right: 6px;
            animation: blink 2s infinite;
        }

        .online-tag .highlight {
            color: #fff;
            font-weight: bold;
            margin: 0 4px;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .breathing-circle-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 0 auto 30px;
            cursor: pointer;
            touch-action: none;
        }

        .breathing-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .breathing-circle.inhaling {
            transform: translate(-50%, -50%) scale(1.5);
        }

        .breathing-circle.exhaling {
            transform: translate(-50%, -50%) scale(1);
        }

        .breathing-text {
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .breathing-instruction {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .breathing-encouragement {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }

        .breathing-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            color: #2c3e50;
            font-weight: bold;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background: #e0e0e0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            transition: width 0.3s ease;
        }

        .breathing-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .breathing-tips {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        .breathing-tips h3 {
            color: #667eea;
            margin-top: 0;
        }

        .breathing-tips ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .breathing-tips li {
            margin-bottom: 6px;
            font-size: 14px;
        }

        /* çŠ¶æ€æŒ‡ç¤º */
        .state-ready {
            color: #667eea;
        }

        .state-inhaling {
            color: #4CAF50;
        }

        .state-exhaling {
            color: #2196F3;
        }

        .state-holding {
            color: #FFC107;
        }

        /* å®Œæˆæ¨¡æ€æ¡† */
        .completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .modal-message {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="breathing-container">
            <div class="breathing-header">
                <h1 class="breathing-title">ğŸŒ¬ï¸ æ·±å‘¼å¸å¹²é¢„</h1>
                <p class="breathing-subtitle">é˜»æ–­å†²åŠ¨å›è·¯</p>
                <div class="online-tag">
                    <span class="dot">â—</span>
                    å½“å‰æœ‰ <span class="highlight" id="onlineCount">521</span> ä½æˆ˜å‹æ­£åœ¨å…±åŒå®ˆæŠ¤
                </div>
            </div>

            <div class="breathing-circle-container" id="breathingCircle">
                <div class="breathing-circle" id="circle">
                    <div class="breathing-text" id="circleText">æŒ‰ä½å¼€å§‹</div>
                </div>
            </div>

            <div class="breathing-instruction" id="instruction">å‡†å¤‡å¥½ï¼Œå¼€å§‹æ·±å‘¼å¸</div>
            <div class="breathing-encouragement" id="encouragement">æŒ‰ä½å±å¹•å¼€å§‹å¸æ°”ï¼ˆ5ç§’ï¼‰</div>

            <div class="breathing-stats">
                <div class="stat-row">
                    <span class="stat-label">å‘¼å¸æ¬¡æ•°:</span>
                    <span class="stat-value" id="breathCount">0/6</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">å†²åŠ¨é˜»æ–­:</span>
                    <span class="stat-value" id="impulseBlockProgress">0%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">æ¢å¤ç­‰çº§:</span>
                    <span class="stat-value" id="impulseBlockLevel">ä½</span>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="breathing-tips">
                <h3>æ·±å‘¼å¸æŒ‡å¯¼:</h3>
                <ul>
                    <li>æŒ‰ä½åœ†åœˆå¼€å§‹å¸æ°”ï¼ˆ5ç§’ï¼‰</li>
                    <li>æ¾å¼€æ‰‹æŒ‡å¼€å§‹å‘¼æ°”ï¼ˆ5ç§’ï¼‰</li>
                    <li>å®Œæˆ6æ¬¡å®Œæ•´å‘¼å¸å‘¨æœŸ</li>
                    <li>ä¸“æ³¨äºå‘¼å¸ï¼Œæ”¾ç©ºæ€ç»ª</li>
                    <li>å†²åŠ¨ä¼šéšç€å‘¼å¸é€æ¸æ¶ˆé€€</li>
                </ul>
            </div>

            <div class="breathing-actions">
                <button class="btn-secondary" onclick="goBackToMain()">ä¸­æ–­è¿”å›</button>
            </div>
        </div>
    </div>

    <!-- å®Œæˆæ¨¡æ€æ¡† -->
    <div class="completion-modal" id="completionModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-title">ğŸ‰ æ·±å‘¼å¸å®Œæˆ</div>
            <div class="modal-message" id="completionMessage">
                æ‚¨å·²ç»å®Œæˆäº†6æ¬¡æ·±å‘¼å¸ç»ƒä¹ ï¼<br>
                å†²åŠ¨å·²ç»è¿‡å»ï¼Œæ‚¨æˆåŠŸé˜»æ–­äº†å†²åŠ¨å›è·¯ï¼<br>
                å½“å‰æœ‰<span id="modalOnlineCount">521</span>ä½æˆ˜å‹æ­£åœ¨å…±åŒå®ˆæŠ¤ã€‚
            </div>
            <div class="modal-actions">
                <button class="btn-primary" onclick="completeBreathing()">ç»§ç»­åšæŒ</button>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€
        const state = {
            circleSize: 200,
            circleScale: 1,
            breathingState: 'ready', // ready, inhaling, exhaling, holding
            instruction: 'å‡†å¤‡å¥½ï¼Œå¼€å§‹æ·±å‘¼å¸',
            encouragement: 'æŒ‰ä½å±å¹•å¼€å§‹å¸æ°”ï¼ˆ5ç§’ï¼‰',
            onlineCount: 521,
            fromSOS: false,
            touchStartTime: 0,
            inhaleDuration: 5000, // å¸æ°”æŒç»­æ—¶é—´ï¼ˆ5ç§’ï¼‰
            exhaleDuration: 5000, // å‘¼æ°”æŒç»­æ—¶é—´ï¼ˆ5ç§’ï¼‰
            breathCount: 0,
            maxBreaths: 6,
            impulseBlockProgress: 0,
            impulseBlockLevel: 'ä½',
            impulseBlockDescription: 'å†²åŠ¨é˜»æ–­æ¢å¤ï¼š0%',
            recoveryStartTime: 0,
            recoveryTimer: null,
            inhaleTimer: null,
            exhaleTimer: null
        };

        // DOMå…ƒç´ 
        const elements = {
            circle: document.getElementById('circle'),
            circleText: document.getElementById('circleText'),
            instruction: document.getElementById('instruction'),
            encouragement: document.getElementById('encouragement'),
            breathCount: document.getElementById('breathCount'),
            impulseBlockProgress: document.getElementById('impulseBlockProgress'),
            impulseBlockLevel: document.getElementById('impulseBlockLevel'),
            progressFill: document.getElementById('progressFill'),
            onlineCount: document.getElementById('onlineCount'),
            modalOnlineCount: document.getElementById('modalOnlineCount'),
            completionModal: document.getElementById('completionModal')
        };

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            // ä»URLå‚æ•°è·å–æ•°æ®
            const params = getUrlParams();
            state.fromSOS = params.fromSOS === 'true';

            // å¦‚æœæ¥è‡ªSOSæŒ‰é’®ï¼Œæ˜¾ç¤ºç‰¹æ®Šæç¤º
            if (state.fromSOS) {
                alert('ç´§æ€¥å¹²é¢„å·²å¯åŠ¨');
            }

            // åˆå§‹åŒ–å‘¼å¸æŒ‡å¯¼
            initBreathingGuide();

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }

        // ä»URLå‚æ•°ä¸­è·å–æ•°æ®
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const pairs = queryString.split('&');

            for (let pair of pairs) {
                const [key, value] = pair.split('=');
                if (key && value) {
                    params[key] = decodeURIComponent(value);
                }
            }

            return params;
        }

        // åˆå§‹åŒ–å‘¼å¸æŒ‡å¯¼
        function initBreathingGuide() {
            updateUI();
            startRecoveryMonitoring();
        }

        // æ›´æ–°UI
        function updateUI() {
            elements.instruction.textContent = state.instruction;
            elements.encouragement.textContent = state.encouragement;
            elements.breathCount.textContent = `${state.breathCount}/${state.maxBreaths}`;
            elements.impulseBlockProgress.textContent = `${state.impulseBlockProgress}%`;
            elements.impulseBlockLevel.textContent = state.impulseBlockLevel;
            elements.circleText.textContent = getCircleText();

            // æ›´æ–°åœ†åœˆçŠ¶æ€
            elements.circle.className = 'breathing-circle ' + state.breathingState;

            // æ›´æ–°è¿›åº¦æ¡
            const progress = state.impulseBlockProgress;
            elements.progressFill.style.width = progress + '%';

            // æ›´æ–°æŒ‡ä»¤é¢œè‰²
            elements.instruction.className = 'breathing-instruction state-' + state.breathingState;
        }

        // è·å–åœ†åœˆæ–‡æœ¬
        function getCircleText() {
            switch (state.breathingState) {
                case 'ready': return 'æŒ‰ä½å¼€å§‹';
                case 'inhaling': return 'å¸æ°”ä¸­...';
                case 'exhaling': return 'å‘¼æ°”ä¸­...';
                case 'holding': return 'å®Œæˆ';
                default: return 'æŒ‰ä½å¼€å§‹';
            }
        }

        // å¯åŠ¨ç”Ÿç†æ¢å¤ç›‘æµ‹
        function startRecoveryMonitoring() {
            // æ¸…ç†ç°æœ‰å®šæ—¶å™¨
            if (state.recoveryTimer) {
                clearInterval(state.recoveryTimer);
            }

            // è®°å½•å¼€å§‹æ—¶é—´
            state.recoveryStartTime = Date.now();

            // å¯åŠ¨å®æ—¶æ›´æ–°å®šæ—¶å™¨ï¼ˆæ¯ç§’æ›´æ–°ï¼‰
            state.recoveryTimer = setInterval(() => {
                updateRecoveryProgress();
            }, 1000);
        }

        // æ›´æ–°å†²åŠ¨é˜»æ–­æ¢å¤è¿›åº¦
        function updateRecoveryProgress() {
            const now = Date.now();
            const elapsedTime = now - state.recoveryStartTime;
            const totalDuration = state.maxBreaths * (state.inhaleDuration + state.exhaleDuration);
            const progressRatio = Math.min(elapsedTime / totalDuration, 1);

            // è®¡ç®—å†²åŠ¨é˜»æ–­æ¢å¤è¿›åº¦ - ä½¿ç”¨æ··åˆæ›²çº¿
            const impulseBlockProgress = Math.min(Math.floor(hybridRecoveryCurve(progressRatio) * 100), 100);

            // æ ¹æ®å†²åŠ¨é˜»æ–­è¿›åº¦ç¡®å®šç­‰çº§å’Œæè¿°
            let impulseBlockLevel = 'ä½';
            let impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}%`;

            if (impulseBlockProgress >= 80) {
                impulseBlockLevel = 'é«˜';
                impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}% - å†²åŠ¨å›è·¯å·²å®Œå…¨é˜»æ–­`;
            } else if (impulseBlockProgress >= 50) {
                impulseBlockLevel = 'ä¸­';
                impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}% - å†²åŠ¨æ˜¾è‘—å‡å¼±`;
            } else if (impulseBlockProgress >= 25) {
                impulseBlockLevel = 'ä½';
                impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}% - å†²åŠ¨å¼€å§‹å‡å¼±`;
            } else if (impulseBlockProgress >= 10) {
                impulseBlockLevel = 'ä½';
                impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}% - å¼€å§‹é˜»æ–­å†²åŠ¨`;
            } else {
                impulseBlockLevel = 'ä½';
                impulseBlockDescription = `å†²åŠ¨é˜»æ–­æ¢å¤ï¼š${impulseBlockProgress}% - å‡†å¤‡é˜»æ–­`;
            }

            state.impulseBlockProgress = impulseBlockProgress;
            state.impulseBlockLevel = impulseBlockLevel;
            state.impulseBlockDescription = impulseBlockDescription;

            updateUI();
        }

        // æ··åˆæ¢å¤æ›²çº¿ - ç»“åˆå¯¹æ•°å’Œçº¿æ€§æ›²çº¿
        function hybridRecoveryCurve(x) {
            if (x <= 0.5) {
                // å‰åŠéƒ¨åˆ†ä½¿ç”¨å¯¹æ•°æ›²çº¿ï¼ˆå¿«é€Ÿæ¢å¤ï¼‰
                return Math.log(1 + 4 * x) / Math.log(5);
            } else {
                // ååŠéƒ¨åˆ†ä½¿ç”¨çº¿æ€§æ›²çº¿ï¼ˆç¨³å®šæ¢å¤ï¼‰
                return 0.5 + 0.5 * (2 * x - 1);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            const circleContainer = document.getElementById('breathingCircle');

            // è§¦æ‘¸å¼€å§‹ - å¸æ°”
            circleContainer.addEventListener('touchstart', onTouchStart, { passive: false });
            circleContainer.addEventListener('mousedown', onTouchStart);

            // è§¦æ‘¸ç»“æŸ - å‘¼æ°”
            circleContainer.addEventListener('touchend', onTouchEnd);
            circleContainer.addEventListener('mouseup', onTouchEnd);
            circleContainer.addEventListener('mouseleave', onTouchEnd);

            // é˜»æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸º
            circleContainer.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, { passive: false });
        }

        // è§¦æ‘¸å¼€å§‹ - å¸æ°”
        function onTouchStart(e) {
            if (state.breathingState !== 'ready' && state.breathingState !== 'holding') {
                return;
            }

            // é˜»æ­¢é»˜è®¤è¡Œä¸º
            if (e.preventDefault) e.preventDefault();

            state.touchStartTime = Date.now();
            state.breathingState = 'inhaling';
            state.instruction = 'å¸æ°”ä¸­...';
            state.encouragement = 'ç»§ç»­æŒ‰ä½ï¼Œå¸æ°”5ç§’';

            updateUI();

            // å¯åŠ¨å¸æ°”å®šæ—¶å™¨
            startInhaleTimer();
        }

        // å¯åŠ¨å¸æ°”å®šæ—¶å™¨
        function startInhaleTimer() {
            // æ¸…ç†ç°æœ‰å®šæ—¶å™¨
            if (state.inhaleTimer) {
                clearTimeout(state.inhaleTimer);
            }

            // å¸æ°”å®Œæˆåè‡ªåŠ¨å¼€å§‹å‘¼æ°”
            state.inhaleTimer = setTimeout(() => {
                if (state.breathingState === 'inhaling') {
                    state.breathingState = 'exhaling';
                    state.instruction = 'å‘¼æ°”ä¸­...';
                    state.encouragement = 'æ¾å¼€æ‰‹æŒ‡ï¼Œå‘¼æ°”5ç§’';

                    updateUI();
                    startExhaleTimer();
                }
            }, state.inhaleDuration);
        }

        // è§¦æ‘¸ç»“æŸ - å‘¼æ°”
        function onTouchEnd(e) {
            if (state.breathingState !== 'inhaling') {
                return;
            }

            const touchDuration = Date.now() - state.touchStartTime;

            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœ€å°å¸æ°”æ—¶é—´
            if (touchDuration >= state.inhaleDuration * 0.8) {
                // æ¸…ç†å¸æ°”å®šæ—¶å™¨
                if (state.inhaleTimer) {
                    clearTimeout(state.inhaleTimer);
                    state.inhaleTimer = null;
                }

                state.breathingState = 'exhaling';
                state.instruction = 'å‘¼æ°”ä¸­...';
                state.encouragement = 'æ¾å¼€æ‰‹æŒ‡ï¼Œå‘¼æ°”5ç§’';

                updateUI();
                startExhaleTimer();
            } else {
                // å¸æ°”æ—¶é—´ä¸è¶³
                resetBreathing();
                state.instruction = 'å¸æ°”æ—¶é—´ä¸è¶³';
                state.encouragement = 'è¯·æŒ‰ä½5ç§’å®Œæˆå¸æ°”';
                updateUI();
            }
        }

        // å¯åŠ¨å‘¼æ°”å®šæ—¶å™¨
        function startExhaleTimer() {
            // æ¸…ç†ç°æœ‰å®šæ—¶å™¨
            if (state.exhaleTimer) {
                clearTimeout(state.exhaleTimer);
            }

            // å‘¼æ°”å®Œæˆåæ›´æ–°çŠ¶æ€
            state.exhaleTimer = setTimeout(() => {
                if (state.breathingState === 'exhaling') {
                    completeBreathCycle();
                }
            }, state.exhaleDuration);
        }

        // å®Œæˆä¸€ä¸ªå‘¼å¸å‘¨æœŸ
        function completeBreathCycle() {
            const newCount = state.breathCount + 1;

            state.breathCount = newCount;
            state.breathingState = 'holding';
            state.instruction = 'å‘¼å¸å®Œæˆ';
            state.encouragement = `å·²å®Œæˆ${newCount}/${state.maxBreaths}æ¬¡å‘¼å¸`;

            updateUI();

            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰å‘¼å¸å‘¨æœŸ
            if (newCount >= state.maxBreaths) {
                completeAllBreathing();
            } else {
                // å‡†å¤‡ä¸‹ä¸€ä¸ªå‘¼å¸å‘¨æœŸ
                setTimeout(() => {
                    state.breathingState = 'ready';
                    state.instruction = 'å‡†å¤‡å¥½';
                    state.encouragement = 'æŒ‰ä½å±å¹•å¼€å§‹ä¸‹ä¸€æ¬¡å¸æ°”';
                    updateUI();
                }, 2000);
            }
        }

        // å®Œæˆæ‰€æœ‰å‘¼å¸å‘¨æœŸ
        function completeAllBreathing() {
            // æ¸…ç†å®šæ—¶å™¨
            cleanupTimers();

            // æ˜¾ç¤ºå®Œæˆæ¨¡æ€æ¡†
            elements.completionModal.style.display = 'flex';
            elements.modalOnlineCount.textContent = state.onlineCount;
        }

        // å®Œæˆæ·±å‘¼å¸
        function completeBreathing() {
            // éšè—æ¨¡æ€æ¡†
            elements.completionModal.style.display = 'none';

            // è¿”å›ä¸»é¡µ
            window.location.href = 'index.html';
        }

        // é‡ç½®å‘¼å¸çŠ¶æ€
        function resetBreathing() {
            // æ¸…ç†å®šæ—¶å™¨
            if (state.inhaleTimer) {
                clearTimeout(state.inhaleTimer);
                state.inhaleTimer = null;
            }

            if (state.exhaleTimer) {
                clearTimeout(state.exhaleTimer);
                state.exhaleTimer = null;
            }

            state.breathingState = 'ready';
            updateUI();
        }

        // è¿”å›ä¸»é¡µ
        function goBackToMain() {
            if (confirm('ç¡®å®šè¦ä¸­æ–­æ·±å‘¼å¸ç»ƒä¹ å—ï¼Ÿå»ºè®®å®Œæˆæ•´ä¸ªè¿‡ç¨‹ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚')) {
                cleanupTimers();
                window.location.href = 'index.html';
            }
        }

        // æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
        function cleanupTimers() {
            if (state.recoveryTimer) {
                clearInterval(state.recoveryTimer);
                state.recoveryTimer = null;
            }

            if (state.inhaleTimer) {
                clearTimeout(state.inhaleTimer);
                state.inhaleTimer = null;
            }

            if (state.exhaleTimer) {
                clearTimeout(state.exhaleTimer);
                state.exhaleTimer = null;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', cleanupTimers);
    </script>
</body>
</html>
